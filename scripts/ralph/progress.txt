# Ralph Progress Log
Started: 2026-02-21
---

## Codebase Patterns
- Cloud Functions (index.ts): v1 compat 사용 - 함수 시그니처 `(data: any, context)` 형태 (NOT `(request)`)
- Flutter 텍스트: `AppTheme.nanum()`, `AppTheme.serif()` 사용 (기본 그림자 내장)
- 색상: `withOpacity()` 대신 `withValues(alpha:)` 사용
- 좌석 등급 순서: 항상 VIP > R > S > A
- Admin: shadcn_flutter 사용시 `import as shad`
- 배포: ticket app은 git push로 Vercel 자동배포, admin은 `firebase deploy --only hosting:admin`

## 2026-02-21 - Pre-Ralph Setup
- Cloud Functions v1/v2 시그니처 불일치 수정 완료 (8개 함수 모두)
- 모의 티켓 생성 화면 (mock_ticket_screen.dart) 구축 완료
- 체크아웃 수량/가격 버그 수정, 텍스트 그림자 전역 적용
---

## 2026-02-21 - MT-001 (스캐너 수동 QR 입력 모드 추가)
- Already implemented before Ralph started
- scanner_screen.dart: _showManualQrInput() method with AlertDialog, keyboard icon button in header
- Passes flutter analyze
- **Learnings:** Check existing code before implementing - features may already exist
---

## 2026-02-21 - MT-002 (티켓 상세 QR 데이터 클립보드 복사 버튼)
- Already implemented before Ralph started
- ticket_detail_screen.dart: _QrSection has TextButton.icon with copy functionality
- Uses Clipboard.setData + SnackBar feedback, only shown when _qrData != null
- Passes flutter analyze
- **Learnings:** Same as MT-001 - pre-existing implementation
---

## 2026-02-21 - MT-003 (모의예매 전체 플로우 오류 수정)
- **Fix 1**: confirmPaymentAndAssignSeats now returns `ticketIds` array in response
  - Added `ticketIds: string[]` collection in ticket creation loop (index.ts)
  - Added `ticketIds` to return object
- **Fix 2**: demo_test_screen.dart QR token key mismatch
  - Changed `qrResult['qrData']` → `qrResult['token']` (matching Cloud Function's actual return key)
- **Cleanup**: Removed unused `_orderResult`, `_confirmResult` fields and unused `ticket.dart` import
- Files changed: `functions/src/index.ts`, `melon_admin/lib/features/admin/demo_test_screen.dart`
- flutter analyze (admin): 0 warnings, npm run build: pass
- **Learnings for future iterations:**
  - Cloud Function returns must match client expectations (field name mismatches are common)
  - issueQrToken returns `{ token: "ticketId:jwt" }` NOT `{ qrData: ... }`
  - confirmPaymentAndAssignSeats transaction creates tickets but previously didn't return their IDs
  - mock_ticket_screen.dart uses direct Firestore batch writes (bypasses Cloud Functions intentionally)
---

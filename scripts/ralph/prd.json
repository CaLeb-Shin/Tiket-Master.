{
  "project": "MelonTicket",
  "branchName": "main",
  "description": "멜론티켓 - 공유/마일리지 시스템 + 모의예매 안정화 + QR 입장 테스트 환경",
  "userStories": [
    {
      "id": "MT-001",
      "title": "스캐너 수동 QR 입력 모드 추가",
      "description": "카메라가 없는 웹 환경에서도 QR 데이터를 수동 입력하여 체크인할 수 있도록 스캐너 화면에 수동 입력 기능을 추가한다.",
      "acceptanceCriteria": [
        "scanner_screen.dart 헤더에 키보드 아이콘 버튼 추가 (카메라 전환 옆)",
        "아이콘 클릭시 AlertDialog로 QR 문자열 붙여넣기 가능",
        "입력값을 기존 _processQrCode() 경로로 전달",
        "flutter analyze 통과"
      ],
      "priority": 1,
      "passes": true,
      "notes": "scanner_screen.dart의 _processQrCode 메서드를 재활용. 웹에서 카메라 없이 테스트 가능하게."
    },
    {
      "id": "MT-002",
      "title": "티켓 상세 QR 데이터 클립보드 복사 버튼",
      "description": "티켓 상세 화면의 QR 코드 아래에 복사 버튼을 추가하여 QR 데이터를 클립보드에 복사할 수 있게 한다. 스캐너 수동 입력에 붙여넣기 용도.",
      "acceptanceCriteria": [
        "ticket_detail_screen.dart의 _QrSection에 복사 버튼 추가",
        "_qrData가 있을 때만 버튼 표시",
        "클릭시 Clipboard.setData로 복사 + SnackBar 피드백",
        "import 'package:flutter/services.dart' 추가",
        "flutter analyze 통과"
      ],
      "priority": 2,
      "passes": true,
      "notes": "_QrSection 위젯 내부의 QR 유효시간 뱃지 아래에 추가. AppTheme.nanum(fontSize: 12) 스타일."
    },
    {
      "id": "MT-003",
      "title": "모의예매 전체 플로우 오류 수정 (예매~결제~발권)",
      "description": "데모 테스트 화면과 모의 티켓 생성을 통해 예매→결제→발권 플로우를 끝까지 오류 없이 완료할 수 있도록 수정한다. Cloud Functions 호출, Firestore 데이터 정합성 등 모든 단계 검증.",
      "acceptanceCriteria": [
        "demo_test_screen.dart에서 createOrder → confirmPaymentAndAssignSeats 순차 호출 성공",
        "mock_ticket_screen.dart에서 Firestore 직접 쓰기로 티켓 생성 성공",
        "생성된 티켓이 마이티켓에 정상 표시",
        "오류 발생 시 명확한 에러 메시지 표시 (INTERNAL 에러 X)",
        "flutter analyze 통과"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Cloud Functions는 이미 v1 시그니처로 수정 완료. 클라이언트 호출부가 올바른 파라미터를 보내는지 확인. demo_test_screen.dart, mock_ticket_screen.dart 점검."
    },
    {
      "id": "MT-004",
      "title": "취소/환불 시 좌석 상태 복원 및 엣지케이스 처리",
      "description": "티켓 취소 시 예약된 좌석이 다시 available로 풀리고, 주문/티켓/좌석블록 상태가 일관성 있게 업데이트되는지 확인. 부분 취소(2장 중 1장만), 전체 취소, 이미 입장한 티켓 취소 시도 등 엣지케이스 처리.",
      "acceptanceCriteria": [
        "requestTicketCancellation 호출 시 해당 좌석 status가 available로 복원",
        "event.availableSeats가 +1 증가",
        "주문 내 모든 티켓 취소 시 order.status가 refunded로 변경",
        "부분 취소 시 order.status 유지, canceledCount 증가",
        "이미 체크인된 티켓 취소 시도 시 적절한 에러 메시지",
        "취소 후 마이티켓에서 해당 티켓 상태가 '취소됨'으로 표시",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 4,
      "passes": true,
      "notes": "requestTicketCancellation Cloud Function은 이미 좌석 복원 로직 포함. 클라이언트 UI에서 취소 후 화면 갱신이 제대로 되는지 확인. ticket_detail_screen.dart의 취소 버튼 동작 점검."
    },
    {
      "id": "MT-005",
      "title": "마일리지 데이터 모델 및 Firestore 구조 설계",
      "description": "사용자 마일리지 시스템의 기초 데이터 모델을 설계하고 구현한다. users 문서에 mileage 필드 추가, mileageHistory 컬렉션 생성, 마일리지 적립/차감 Cloud Function 구현.",
      "acceptanceCriteria": [
        "melon_core에 Mileage 모델 추가 (balance, tier, totalEarned)",
        "melon_core에 MileageHistory 모델 추가 (userId, amount, type, reason, createdAt)",
        "type 종류: purchase(구매적립), referral(추천적립), upgrade(등급업 차감)",
        "users 문서에 mileage 필드 추가 (balance: 0, tier: 'bronze', totalEarned: 0)",
        "addMileage Cloud Function: userId, amount, type, reason → mileageHistory 기록 + users.mileage.balance 업데이트",
        "npm run build 통과, flutter analyze 통과"
      ],
      "priority": 5,
      "passes": true,
      "notes": "등급 체계: Bronze(0~) → Silver(5000~) → Gold(15000~) → Platinum(30000~). 구매 적립: 결제금액의 5%. 추천 적립: 추천인에게 500P."
    },
    {
      "id": "MT-006",
      "title": "추천 코드 생성 및 공유하기 기능",
      "description": "각 사용자에게 고유 추천 코드를 부여하고, 공연 상세 페이지에서 추천 코드가 포함된 링크를 공유할 수 있게 한다.",
      "acceptanceCriteria": [
        "users 문서에 referralCode 필드 추가 (최초 로그인 시 8자리 영숫자 자동 생성)",
        "melon_core에 referralCode 생성 유틸 추가",
        "event_detail_screen.dart에 공유 버튼 추가 (Share 아이콘)",
        "공유 시 URL 형식: https://melonticket-web-20260216.vercel.app/event/{eventId}?ref={referralCode}",
        "공유 방법: 클립보드 복사 + 네이티브 Share API (웹: navigator.share, 없으면 클립보드)",
        "공유 성공 시 SnackBar 피드백",
        "flutter analyze 통과"
      ],
      "priority": 6,
      "passes": true,
      "notes": "referralCode는 중복 불가. Firestore에서 유니크 체크. URL의 ref 파라미터는 예매 시 서버로 전달되어 추천인 추적에 사용."
    },
    {
      "id": "MT-007",
      "title": "추천 링크로 예매 시 추천인 마일리지 적립",
      "description": "추천 코드가 포함된 링크로 접속하여 예매를 완료하면, 추천인에게 마일리지가 적립되고 구매자에게도 구매 마일리지가 적립된다.",
      "acceptanceCriteria": [
        "예매 플로우에서 ref 쿼리 파라미터를 추출하여 주문에 저장 (order.referralCode)",
        "confirmPaymentAndAssignSeats에서 결제 성공 시: 구매자에게 결제금액 5% 마일리지 적립",
        "referralCode가 있으면: 추천인 userId 조회 → 추천인에게 500P 적립",
        "자기 자신 추천 방지 (referralCode 소유자 == 구매자이면 무시)",
        "mileageHistory에 적립 내역 기록",
        "npm run build 통과"
      ],
      "priority": 7,
      "passes": true,
      "notes": "createOrder에 referralCode 파라미터 추가. confirmPaymentAndAssignSeats 트랜잭션 외부에서 마일리지 적립 처리 (트랜잭션 무겁지 않게)."
    },
    {
      "id": "MT-008",
      "title": "마이페이지 마일리지 현황 UI",
      "description": "마이페이지에서 현재 마일리지 잔액, 등급, 적립 내역을 확인할 수 있는 UI를 구현한다.",
      "acceptanceCriteria": [
        "마이페이지(또는 마이티켓 화면)에 마일리지 섹션 추가",
        "현재 잔액 표시 (숫자 + P 단위)",
        "현재 등급 표시 (Bronze/Silver/Gold/Platinum + 아이콘/색상)",
        "다음 등급까지 남은 마일리지 프로그레스 바",
        "최근 적립/차감 내역 리스트 (최대 10건, 더보기 가능)",
        "내역 항목: 날짜, 유형(구매/추천/업그레이드), 금액(+/-), 사유",
        "flutter analyze 통과"
      ],
      "priority": 8,
      "passes": true,
      "notes": "디자인: 다크 테마 + 골드 악센트. 등급 색상 - Bronze(#CD7F32), Silver(#C0C0C0), Gold(#C9A84C), Platinum(#E5E4E2). AppTheme 활용."
    },
    {
      "id": "MT-009",
      "title": "마일리지로 좌석 등급 업그레이드",
      "description": "일정 마일리지를 모은 사용자가 보유한 티켓의 좌석 등급을 한 단계 업그레이드할 수 있는 기능. 할인이 아니라 구매 후 업그레이드 개념.",
      "acceptanceCriteria": [
        "티켓 상세 화면에 '좌석 업그레이드' 버튼 추가 (조건 충족 시만 표시)",
        "업그레이드 가능 조건: 티켓 status=issued, 상위 등급 잔여 좌석 존재, 충분한 마일리지",
        "업그레이드 비용: A→S(2000P), S→R(3000P), R→VIP(5000P)",
        "upgradeTicketSeat Cloud Function 구현: 마일리지 차감 + 기존 좌석 available로 반환 + 상위 등급 좌석 배정 + 티켓 seatId 업데이트",
        "업그레이드 성공 시 마일리지 차감 내역 기록 (type: upgrade)",
        "업그레이드 후 티켓 상세 화면에 새 좌석 정보 반영",
        "npm run build 통과, flutter analyze 통과"
      ],
      "priority": 9,
      "passes": true,
      "notes": "VIP는 더 이상 업그레이드 불가. 상위 등급 좌석이 없으면 '잔여 좌석이 없습니다' 메시지. 트랜잭션으로 좌석 교환 원자성 보장."
    },
    {
      "id": "MT-010",
      "title": "추천 코드 & 마일리지 어드민 관리",
      "description": "어드민 대시보드에서 사용자별 마일리지 현황, 추천 통계, 수동 마일리지 지급/차감이 가능한 관리 화면을 추가한다.",
      "acceptanceCriteria": [
        "admin 사이드바에 '마일리지 관리' 메뉴 추가",
        "사용자별 마일리지 잔액, 등급, 추천 횟수 목록 표시",
        "수동 마일리지 지급/차감 기능 (관리자용)",
        "추천 통계: 총 추천 수, 추천으로 발생한 예매 수",
        "flutter analyze 통과"
      ],
      "priority": 10,
      "passes": true,
      "notes": "melon_admin에 구현. AdminTheme, shadcn_flutter 사용. 기존 admin_orders_screen 스타일 참고."
    },
    {
      "id": "MT-011",
      "title": "취소/환불 수수료 규정 적용",
      "description": "실제 티켓 서비스 기준의 취소 수수료 체계를 적용한다. 예매 후 7일 이내 무료취소, 이후 시점별 수수료 부과. Cloud Function + 클라이언트 UI에 규정 안내 표시.",
      "acceptanceCriteria": [
        "requestTicketCancellation Cloud Function 수수료 로직 변경:",
        "  - 예매 후 7일 이내: 취소 수수료 없음 (100% 환불)",
        "  - 예매 후 8일 ~ 관람일 10일 전: 뮤지컬/콘서트/클래식 등 공연권 4,000원 / 연극/전시 등 입장권 2,000원 (단, 티켓금액의 10% 이내)",
        "  - 관람일 9일 전 ~ 7일 전: 티켓금액의 10%",
        "  - 관람일 6일 전 ~ 3일 전: 티켓금액의 20%",
        "  - 관람일 2일 전 ~ 1일 전: 티켓금액의 30%",
        "  - 관람 당일: 취소/환불 불가",
        "  - 예매당일 취소 시 예매수수료 환불 안 됨 (예매당일 외에는 환불)",
        "티켓 상세 및 취소 확인 다이얼로그에 수수료 미리보기 표시",
        "결제(checkout) 화면에서 취소 수수료 규정 안내 표시 (결제 전 사용자에게 취소 시 수수료 발생 가능 고지)",
        "취소 수수료 안내 페이지/바텀시트 추가",
        "npm run build 통과, flutter analyze 통과"
      ],
      "priority": 11,
      "passes": true,
      "notes": "기존 단순 24시간/3시간 기준 로직을 실제 규정으로 교체. Event.category에 따라 공연권/입장권 구분 (콘서트,뮤지컬,클래식=공연권 4000원, 연극,전시=입장권 2000원). 예매일은 order.createdAt 기준."
    },
    {
      "id": "MT-012",
      "title": "공연 상세 360° 좌석뷰 태그 표시",
      "description": "공연 상세 페이지의 카테고리 태그(콘서트) 옆에, 해당 공연장에 좌석 시야 사진이 있는 경우 '360° 좌석뷰' 태그를 추가 표시한다.",
      "acceptanceCriteria": [
        "event_detail_screen 또는 mobile_main_screen의 공연 카드에서 카테고리 태그 옆에 '360° 좌석뷰' 태그 추가",
        "해당 공연의 venueId로 venueSeatViews 컬렉션에 is360=true인 문서가 1건 이상 있을 때만 표시",
        "태그 스타일: 골드 계열, 기존 카테고리 태그와 일관된 디자인",
        "flutter analyze 통과"
      ],
      "priority": 12,
      "passes": true,
      "notes": "venueSeatViews 컬렉션에서 venueId 기준 쿼리. 성능을 위해 캐싱 또는 events 문서에 has360View 불리언 필드 추가 고려. 모바일 메인의 바로예매 카드에도 적용."
    },
    {
      "id": "MT-013",
      "title": "임시 게스트 계정으로 예매~발권 체험 기능",
      "description": "로그인 없이 임시 계정을 생성하여 좌석 선택 → 예매 → 발권까지 전체 플로우를 체험할 수 있는 기능. 나중에 제거 예정인 테스트/데모용 기능.",
      "acceptanceCriteria": [
        "로그인 화면 또는 예매 진입 시 '체험하기' 버튼 추가",
        "Firebase Anonymous Auth로 임시 계정 생성",
        "임시 계정으로 좌석 선택 → 결제(무료/모의) → 티켓 발권 전체 플로우 가능",
        "임시 계정 사용자에게 '체험 모드' 표시 (프로필에 뱃지)",
        "체험 계정의 티켓은 실제 좌석 차지하지 않거나, 별도 플래그(isDemo) 표시",
        "나중에 기능 제거를 위한 플래그/조건부 코드 사용",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Firebase Anonymous Auth 사용. 체험 주문에는 order.isDemo=true 플래그. Cloud Function에서 isDemo 주문은 실제 좌석 reserve 안 하거나 별도 처리. 임시 기능이므로 조건부 코드로 쉽게 제거 가능하게."
    },
    {
      "id": "MT-014",
      "title": "마일리지 보상 시스템 확장 (구매량·리뷰·뱃지)",
      "description": "마일리지 적립 체계를 확장한다. 많이 구매할수록 더 높은 비율로 적립되고, 리뷰 작성 시 마일리지 + 뱃지 보상을 제공한다.",
      "acceptanceCriteria": [
        "구매 마일리지 적립률 등급별 차등: Bronze 3%, Silver 5%, Gold 7%, Platinum 10%",
        "리뷰 작성 기능 추가: 관람 완료 티켓에 별점(1~5) + 한줄평 작성 가능",
        "리뷰 작성 시 마일리지 적립 (예: 200P, 첫 리뷰 500P)",
        "리뷰 작성자 닉네임 옆에 '리뷰어' 뱃지 표시",
        "뱃지 시스템: 첫 리뷰(🎭), 3회 리뷰(⭐), 10회 리뷰(👑) 등 단계별 뱃지",
        "리뷰 모델: reviews 컬렉션 (userId, eventId, ticketId, rating, comment, createdAt)",
        "마이페이지에 내 리뷰 목록 + 뱃지 표시",
        "공연 상세에 리뷰 섹션 (평균 별점 + 최근 리뷰)",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 14,
      "passes": true,
      "notes": "MileageType에 'review' 추가. AppUser에 badges 필드(리스트) 추가. 뱃지 종류: first_review, reviewer_3, reviewer_10, top_buyer 등. 리뷰는 관람 완료(status=used) 티켓만 작성 가능. 중복 리뷰 방지(eventId+userId 유니크)."
    },
    {
      "id": "MT-015",
      "title": "공연 운영 대시보드 - 최근 공연 옵션 메뉴",
      "description": "어드민 공연 운영 대시보드의 최근 공연 목록에서 각 공연을 클릭하면 옵션 메뉴(수정, 삭제, 좌석현황, 주문목록 등)가 나오도록 한다.",
      "acceptanceCriteria": [
        "최근 공연 리스트 아이템 클릭 시 컨텍스트 메뉴/팝업 메뉴 표시",
        "메뉴 항목: 공연 수정, 공연 삭제, 좌석 현황 보기, 주문 목록, 공연 복제",
        "공연 수정: event_create_screen으로 editMode 이동",
        "공연 삭제: 확인 다이얼로그 후 status를 canceled로 변경",
        "좌석 현황: 해당 공연의 좌석별 예매/잔여 현황",
        "주문 목록: 해당 공연의 주문 필터링",
        "공연 복제: 기존 공연 데이터 기반으로 새 공연 등록 폼 열기",
        "flutter analyze 통과"
      ],
      "priority": 15,
      "passes": true,
      "notes": "melon_admin에 구현. shadcn_flutter의 DropdownMenu 또는 PopupMenuButton 사용. 기존 admin_events_screen 또는 dashboard의 공연 목록 부분에 적용."
    },
    {
      "id": "MT-016",
      "title": "공연 등록 - 주최/기획 예시 텍스트 제거",
      "description": "공연 등록 화면의 주최, 기획 입력 필드에서 예시(placeholder) 텍스트를 제거한다.",
      "acceptanceCriteria": [
        "event_create_screen.dart의 주최 필드 placeholder 제거 또는 빈 문자열로 변경",
        "기획 필드 placeholder 제거 또는 빈 문자열로 변경",
        "flutter analyze 통과"
      ],
      "priority": 16,
      "passes": true,
      "notes": "간단한 UI 변경. _field('주최', ...) 와 _field('기획', ...)의 decoration에서 hintText 제거."
    },
    {
      "id": "MT-017",
      "title": "공연 등록 - 다회 공연(연속 회차) 지원",
      "description": "하루 1회 공연뿐만 아니라, 여러 날짜에 걸쳐 여러 회차를 등록할 수 있도록 공연 등록 UI와 데이터 모델을 확장한다.",
      "acceptanceCriteria": [
        "Event 모델에 회차(sessions) 개념 추가 또는 상위 시리즈 모델 도입",
        "공연 등록 UI에 '회차 추가' 버튼 → 날짜/시간별 여러 회차 입력 가능",
        "각 회차별 독립적인 startAt, saleStartAt, saleEndAt, 좌석 관리",
        "공연 상세에서 회차 선택 UI (날짜/시간 탭 또는 드롭다운)",
        "같은 공연장이라도 회차별 좌석이 독립적으로 관리됨",
        "어드민에서 회차별 판매현황 확인 가능",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 17,
      "passes": true,
      "notes": "접근법 2가지: (1) EventSeries 상위 모델 + 회차별 Event 문서, (2) Event에 sessions 배열. 추천: (1)이 확장성 좋음. EventSeries(title,poster,category) → Event(seriesId,sessionNumber,startAt,seats). 기존 단일 공연도 sessions=1인 시리즈로 호환. 공연 등록 UI에서 '단일 공연' / '연속 공연' 토글."
    },
    {
      "id": "MT-018",
      "title": "엑셀 좌석배치도 업로드 → 인터랙티브 도트맵 좌석 선택 시스템",
      "description": "관리자가 좌석 등급별로 나눠진 좌석배치도 엑셀 파일을 업로드하면, 시스템이 분석하여 도트 기반 인터랙티브 좌석 배치도를 자동 생성한다. 사용자는 이 도트맵에서 개별 좌석을 클릭하여 예매할 수 있다. 가장 핵심 기능.",
      "acceptanceCriteria": [
        "어드민: 엑셀(.xlsx) 파일 업로드 기능 (공연장 등록 또는 공연 등록 시)",
        "엑셀 파싱: 좌석 등급(VIP/R/S/A), 구역, 층, 열, 좌석번호 자동 인식",
        "엑셀 데이터 → Firestore seats 컬렉션으로 변환 저장 (venueId, zone, floor, row, seatNumber, grade, x, y 좌표)",
        "어드민: 파싱 결과 미리보기 (도트맵으로 시각화, 등급별 색상 구분)",
        "어드민: 미리보기에서 좌석 위치/등급 수동 조정 가능",
        "어드민: 수동 편집 모드 — 그리드 도트(빈 자리)가 깔린 캔버스에서, 현재 선택된 좌석 등급으로 빈 도트 클릭하면 해당 등급 좌석으로 채워짐",
        "어드민: 상단 툴바에서 등급(VIP/R/S/A) 선택 후 빈 도트 클릭 = 페인트 방식으로 좌석 배치",
        "어드민: 개별 좌석 클릭 → 속성 편집 (등급, 구역, 열, 번호 변경)",
        "어드민: 좌석 유형 설정 — 일반석, 장애인석(휠체어), 유보석(판매 보류) 지원",
        "어드민: 장애인석은 별도 아이콘/색상 표시, 유보석은 예매 불가 상태로 잠금",
        "어드민: 좌석 드래그 이동, 다중 선택 후 일괄 등급/유형 변경",
        "티켓앱: Canvas 기반 인터랙티브 도트맵 좌석 선택 UI",
        "티켓앱: 핀치 줌/패닝, 등급별 색상 구분 (VIP=골드, R=레드, S=블루, A=그린)",
        "티켓앱: 좌석 클릭 시 좌석 정보 표시 (등급, 구역, 열, 번호, 가격)",
        "티켓앱: 선택한 좌석 실시간 예매 상태 반영 (available/reserved/sold 색상 구분)",
        "티켓앱: 다중 좌석 선택 지원 (최대 maxTicketsPerOrder 매수까지)",
        "무대 위치 표시 (상단/하단)",
        "기존 자동 생성 좌석 구조와 호환 (엑셀 업로드 or 기존 방식 선택 가능)",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 1,
      "passes": true,
      "notes": "핵심 기능. 기존 프리셋 방식 대체. 엑셀 파싱은 Cloud Function(xlsx 라이브러리) 또는 클라이언트(dart excel 패키지). 좌석 좌표(x,y)는 엑셀의 행/열 위치에서 자동 계산하되, 어드민에서 드래그로 조정 가능하게. 도트맵 렌더링은 CustomPainter + GestureDetector. 대규모 공연장(1000석+)에서도 성능 유지 필요. 좌석 등급 색상: VIP=#C9A84C(골드), R=#E53935(레드), S=#1E88E5(블루), A=#43A047(그린). sold=#555555(회색), reserved=#FFA000(주황). 좌석 유형(seatType): normal(일반), wheelchair(장애인석), reserved_hold(유보석). 유보석은 어드민만 해제 가능. 수동 편집 모드: 그리드 도트(빈 원) 캔버스가 기본 → 등급 선택 후 빈 도트 클릭하면 해당 등급 색상으로 채워짐(페인트 방식). 채워진 좌석 클릭하면 비우기/등급변경. Delete키로 삭제."
    },
    {
      "id": "MT-019",
      "title": "비지정석(스탠딩) 예매 모드 지원",
      "description": "공연 등록 시 '비지정석' 옵션을 설정할 수 있게 하여, 모든 좌석이 등급 없이 배정되고 입장번호만 부여되는 스탠딩 공연 예매를 지원한다.",
      "acceptanceCriteria": [
        "Event 모델에 isStanding(비지정석) 불리언 필드 추가",
        "어드민 공연 등록 시 '비지정석(스탠딩)' 토글 추가 — ON 시 좌석 배치/등급 설정 비활성화",
        "비지정석 공연은 좌석 등급 없이 단일 가격으로 운영",
        "예매 시 좌석 선택 UI 대신 수량 선택 UI 표시",
        "발권 시 좌석번호 대신 입장번호(순번) 부여 (예: 입장번호 #001, #002...)",
        "티켓 상세에서 '입장번호' 표시 (좌석 정보 대신)",
        "QR 체크인 시 입장번호 기반 처리",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 19,
      "passes": true,
      "notes": "스탠딩 공연, 페스티벌 등 좌석 지정이 필요 없는 공연 유형 지원. isStanding=true이면 seats 컬렉션 사용 안 하고, 티켓에 entryNumber 필드 추가. 입장번호는 예매 순서대로 자동 부여. maxTicketsPerOrder로 1인 최대 구매 수량 제한은 동일하게 적용."
    },
    {
      "id": "MT-020",
      "title": "정산 시스템 — 공연 후 수수료 차감 및 계좌 입금 승인",
      "description": "티켓 판매 금액이 공연 종료 후 관리자가 수수료를 차감하고 최종 승인하면, 등록된 주최자 계좌로 정산금이 입금되는 정산 프로세스를 구현한다.",
      "acceptanceCriteria": [
        "Event 모델 또는 별도 Settlement 모델에 정산 관련 필드 추가 (수수료율, 정산상태, 정산일, 정산계좌 등)",
        "어드민 공연 등록 시 정산 계좌 정보 입력 (은행명, 계좌번호, 예금주)",
        "어드민 정산 관리 화면 추가 — 공연별 총 매출, 수수료, 정산 예정액 표시",
        "공연 종료 후 관리자가 수수료율(%) 설정 및 '정산 승인' 버튼 클릭",
        "정산 승인 시 Settlement 문서 생성 (eventId, totalSales, feeRate, feeAmount, settlementAmount, bankInfo, status, approvedAt)",
        "정산 상태: pending(대기) → approved(승인) → transferred(입금완료)",
        "정산 내역 히스토리 조회 가능",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 20,
      "passes": true,
      "notes": "실제 은행 송금 API 연동은 추후. 현재는 관리자가 수동으로 '입금완료' 상태 변경하는 방식. 수수료율 기본값: 10%. 정산 계좌는 주최자(organizer)에 연결. settlements 컬렉션에 문서 저장."
    },
    {
      "id": "MT-021",
      "title": "최근 공연 목록 — 행 전체 클릭으로 옵션 메뉴 열기",
      "description": "어드민 대시보드의 최근 공연 목록에서 '옵션' 버튼뿐만 아니라, 해당 공연 행(row) 어디를 클릭해도 옵션 안내창이 뜨도록 개선한다.",
      "acceptanceCriteria": [
        "최근 공연 리스트의 각 행 전체를 클릭 가능 영역으로 설정",
        "행 어디를 클릭해도 기존 '옵션' 버튼과 동일한 옵션 메뉴/팝업 표시",
        "행 hover 시 배경색 변화로 클릭 가능함을 시각적으로 안내",
        "기존 '옵션' 버튼은 유지하되, 행 클릭과 동일 동작",
        "flutter analyze 통과"
      ],
      "priority": 21,
      "passes": true,
      "notes": "InkWell 또는 GestureDetector로 행 전체 감싸기. 기존 옵션 메뉴 로직 재활용. hover 효과는 AdminTheme.sage.withValues(alpha: 0.08) 정도."
    },
    {
      "id": "MT-022",
      "title": "어드민 대시보드 배너 및 UI 입체감 개선",
      "description": "공연장 관리, 새 공연 등록 배너를 더 크고 입체감 있게 만들고, 공연 운영 대시보드에 그림자 효과를 넣고, 어드민 전체 텍스트에 그림자를 적용하여 검정 배경에서 묻히지 않도록 한다.",
      "acceptanceCriteria": [
        "공연장 관리 / 새 공연 등록 배너 크기 확대 (높이 증가, 패딩 확대)",
        "배너에 그라디언트, 보더, 박스쉐도우 등 입체감 효과 추가",
        "공연 운영 대시보드 카드/섹션에 boxShadow 효과 적용",
        "AdminTheme에 텍스트 그림자 유틸 추가 (모든 주요 텍스트에 미묘한 그림자)",
        "어드민 전체 텍스트가 검정 배경에서 선명하게 보이도록 textShadow 적용",
        "기존 디자인 톤(다크+골드) 유지하면서 깊이감 추가",
        "flutter analyze 통과"
      ],
      "priority": 22,
      "passes": true,
      "notes": "AdminTheme에 textShadow 스타일 헬퍼 추가. boxShadow는 어두운 테마에 맞게 미묘하게 — 예: BoxShadow(color: Colors.black54, blurRadius: 12, offset: Offset(0,4)). 배너는 현재 OutlinedButton 기반 → Container + 그라디언트 + 아이콘 + 텍스트로 리디자인. 과하지 않게 우아한 입체감."
    },
    {
      "id": "MT-023",
      "title": "어드민 사이드바 — 접이식 오버레이 메뉴 (드로어)",
      "description": "어드민 왼쪽 사이드바 네비게이션을 고정형이 아닌, 어떤 화면에서든 열고 닫을 수 있는 오버레이(드로어) 방식으로 변경한다. 햄버거 메뉴 버튼으로 토글하며, 메뉴가 콘텐츠 위에 팝업처럼 슬라이드 인/아웃된다.",
      "acceptanceCriteria": [
        "사이드바가 기본적으로 접혀 있고, 햄버거 아이콘 클릭 시 슬라이드 인으로 열림",
        "사이드바 바깥 영역 클릭 시 자동으로 닫힘",
        "사이드바가 콘텐츠 영역 위에 오버레이로 표시 (콘텐츠 밀어내기 X)",
        "열릴 때 반투명 배경(scrim) 표시로 포커스 유도",
        "메뉴 항목 클릭 시 해당 화면으로 이동 + 사이드바 자동 닫힘",
        "슬라이드 애니메이션 (300ms 정도, ease-in-out)",
        "모든 어드민 화면 상단에 햄버거 메뉴 버튼 통일 배치",
        "flutter analyze 통과"
      ],
      "priority": 23,
      "passes": true,
      "notes": "Flutter Drawer 또는 커스텀 AnimatedContainer + Overlay 사용. 현재 Row(sidebar, content) 구조를 Scaffold + Drawer 또는 Stack 기반으로 변경. 사이드바 열린 상태에서 ESC 키로도 닫기. 기존 메뉴 항목(대시보드, 공연관리, 통계, 공연장관리, 마일리지관리, 데모테스트, 모의티켓생성) 그대로 유지."
    },
    {
      "id": "MT-024",
      "title": "멀티 셀러 플랫폼 — 개별 어드민(판매자) 계정 시스템",
      "description": "스마트스토어처럼 누구나 자신의 어드민 계정을 만들어 공연을 올리고 수익을 받을 수 있는 멀티 셀러 플랫폼 구조로 전환한다. 슈퍼어드민(플랫폼 운영자)은 모든 셀러 계정을 관리한다.",
      "acceptanceCriteria": [
        "역할 체계 도입: superAdmin(플랫폼 운영자), seller(판매자/주최자), user(일반 사용자)",
        "AppUser 모델에 role 필드 추가 (superAdmin / seller / user)",
        "셀러 가입 플로우: 일반 사용자가 '판매자 등록' 신청 → 사업자 정보 입력 (상호명, 사업자번호, 대표자명, 연락처)",
        "슈퍼어드민 승인 후 seller 역할 활성화",
        "셀러별 독립 대시보드: 자신이 등록한 공연만 조회/관리 (venueId, eventId에 sellerId 연결)",
        "슈퍼어드민 대시보드: 모든 셀러 목록, 전체 공연 통합 관리, 셀러 승인/정지/탈퇴 처리",
        "Event 모델에 sellerId 필드 추가 — 공연 등록 시 자동으로 현재 셀러 ID 저장",
        "셀러는 자기 공연의 주문/좌석/통계만 접근 가능 (Firestore Security Rules로 격리)",
        "슈퍼어드민은 모든 데이터 접근 가능",
        "셀러 프로필 페이지: 상호명, 로고, 소개글, 연락처 관리",
        "티켓앱에서 공연 상세에 판매자(주최자) 정보 표시",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 24,
      "passes": true,
      "notes": "핵심 아키텍처 변경. users 컬렉션에 role, sellerProfile(상호명, 사업자번호, 대표자명, 연락처, 로고URL, 소개글, 가입일, 상태) 서브맵 추가. Firestore Security Rules에서 seller는 자기 sellerId 데이터만 읽기/쓰기. superAdmin은 모든 것에 접근. 기존 isAdmin 필드는 role=='superAdmin' || role=='seller'로 대체. 라우팅에서 역할별 접근제어 적용."
    },
    {
      "id": "MT-025",
      "title": "에스크로 결제 시스템 — 예치금 기반 안전 결제/환불",
      "description": "네이버 스마트스토어 방식의 에스크로 결제 시스템을 구현한다. 결제 시 금액이 플랫폼에 예치되고, 공연 완료 후 수수료를 제외한 금액이 셀러에게 정산된다. 환불/취소 시 예치금에서 차감하여 즉시 환불 처리한다.",
      "acceptanceCriteria": [
        "── 데이터 모델 ──",
        "EscrowAccount 모델: sellerId, balance(예치 잔액), pendingAmount(정산 대기금), totalDeposited(총 입금액), totalWithdrawn(총 출금액)",
        "EscrowTransaction 모델: id, sellerId, orderId, type(deposit/refund/settlement/platformFee), amount, balanceBefore, balanceAfter, description, createdAt",
        "Settlement 모델: id, sellerId, eventId, period, totalSales, refundAmount, platformFeeRate, platformFeeAmount, settlementAmount, bankInfo, status(pending/approved/transferred), requestedAt, approvedAt, transferredAt",
        "",
        "── 결제 플로우 (입금) ──",
        "사용자 결제 성공 시 → EscrowAccount.balance에 결제금액 전액 적립",
        "EscrowTransaction 기록 (type=deposit, +금액)",
        "Order에 escrowStatus 필드 추가 (deposited/partially_refunded/fully_refunded/settled)",
        "Ticket 발급은 즉시 진행 (결제 완료 = 티켓 발급)",
        "",
        "── 환불 플로우 (출금) ──",
        "취소 요청 시 EscrowAccount.balance에서 환불금액 차감",
        "환불 전 잔액 충분 여부 더블체크 (balance >= refundAmount)",
        "EscrowTransaction 기록 (type=refund, -금액, balanceBefore/After 기록)",
        "수수료 공제 후 환불금 계산: refundAmount = ticketPrice - cancellationFee",
        "환불 처리 후 Order.escrowStatus 업데이트",
        "부분 취소(N장 중 일부): 해당 티켓 금액만 환불, 나머지 예치 유지",
        "",
        "── 정산 플로우 ──",
        "공연 종료 + 환불 가능 기간(7일) 경과 후 정산 가능 상태로 전환",
        "셀러가 '정산 요청' → 슈퍼어드민이 검토 후 '정산 승인'",
        "정산 금액 = 총 매출 - 환불 금액 - 플랫폼 수수료",
        "플랫폼 수수료 EscrowTransaction 기록 (type=platformFee)",
        "정산 EscrowTransaction 기록 (type=settlement, -정산금액)",
        "EscrowAccount.balance 차감, pendingAmount 차감",
        "Settlement.status를 transferred로 변경",
        "",
        "── 안전장치 (더블체크) ──",
        "모든 금액 변동은 Firestore Transaction으로 원자성 보장",
        "balanceBefore + amount == balanceAfter 검증 (매 트랜잭션)",
        "EscrowAccount.balance는 음수 불가 — 환불 시 잔액 부족이면 충전 유도 후 재시도",
        "",
        "── 에스크로 충전 (잔액 부족 대응) ──",
        "슈퍼어드민이 셀러 에스크로 계정에 수동 충전 가능 (type=topup)",
        "셀러가 직접 충전 요청 → 슈퍼어드민 승인 후 잔액 반영",
        "환불 시 잔액 부족이면: 환불 보류(pending_refund) 상태 → 셀러에게 충전 요청 알림 → 충전 완료 후 자동 환불 재처리",
        "충전 금액도 EscrowTransaction으로 기록 (type=topup, +금액, balanceBefore/After)",
        "슈퍼어드민 대시보드에서 잔액 부족 셀러 목록 하이라이트 표시",
        "정산 시 해당 이벤트의 모든 주문 상태 재검증 (미처리 환불 건 확인)",
        "일일 정산 검증 배치: escrowTransactions 합계 == escrowAccount.balance 일치 확인",
        "슈퍼어드민 에스크로 대시보드: 전체 예치금 현황, 셀러별 잔액, 트랜잭션 로그 실시간 조회",
        "금액 계산은 모두 정수(원 단위) — 소수점 반올림 오차 방지",
        "",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 25,
      "passes": true,
      "notes": "가장 중요한 금융 로직. 빈틈없이 구현해야 함. escrowAccounts/{sellerId} 컬렉션, escrowTransactions/{txId} 컬렉션 사용. 모든 금액 변동은 Cloud Function 내 runTransaction으로 처리. 동시 요청(환불+정산 동시) 시에도 데이터 정합성 보장. balanceBefore/balanceAfter로 이중 장부 검증. 실제 PG 연동은 추후(현재는 모의 결제) — 하지만 에스크로 장부 로직은 실전 수준으로 구현. 수수료율은 셀러별/이벤트별 커스텀 가능(기본 10%). 환불 가능 기간(7일)은 설정 가능하게. 충전(topup) 시나리오: 셀러가 정산 후 잔액 0인 상태에서 환불 발생 → 잔액 부족 → 환불 보류(pending_refund) → 셀러에게 충전 알림 → 충전 완료 시 보류 환불 자동 재처리. EscrowTransaction type 종류: deposit(입금), refund(환불), settlement(정산), platformFee(수수료), topup(충전). pending_refund 상태인 주문은 별도 큐로 관리하여 충전 시 FIFO로 처리."
    },
    {
      "id": "MT-026",
      "title": "슈퍼어드민 — 셀러 관리 및 에스크로 모니터링 대시보드",
      "description": "슈퍼어드민(플랫폼 운영자) 전용 화면으로, 모든 셀러 계정 관리, 에스크로 잔액 모니터링, 정산 승인, 트랜잭션 로그 감사를 수행할 수 있는 통합 대시보드를 구축한다.",
      "acceptanceCriteria": [
        "슈퍼어드민 전용 메뉴: 셀러 관리, 에스크로 현황, 정산 관리, 감사 로그",
        "셀러 관리: 가입 신청 목록 / 승인 / 정지 / 탈퇴 처리",
        "셀러 상세: 프로필, 등록 공연 목록, 매출 통계, 에스크로 잔액",
        "에스크로 현황: 플랫폼 전체 예치금 총합, 셀러별 잔액 목록, 이상 거래 알림",
        "정산 관리: 정산 요청 목록, 금액 검증, 승인/거절, 입금 완료 처리",
        "감사 로그: escrowTransactions 전체 조회 (필터: 셀러, 기간, 유형, 금액 범위)",
        "일일 정합성 체크 결과 표시 (트랜잭션 합계 vs 잔액 불일치 건 하이라이트)",
        "슈퍼어드민만 접근 가능 (role 기반 라우팅 가드)",
        "flutter analyze 통과"
      ],
      "priority": 26,
      "passes": true,
      "notes": "melon_admin에 구현. 슈퍼어드민 전용 라우트/화면. 셀러 관리 CRUD + 상태 변경. 에스크로 대시보드는 실시간 Firestore 스트림. 정산 승인은 더블 확인 다이얼로그. 감사 로그는 페이지네이션 + 필터 + CSV 내보내기. AdminTheme 기반 UI."
    },
    {
      "id": "MT-027",
      "title": "공연 삭제 보호 — 예매자 존재 시 삭제 차단 및 전원 환불 후 삭제",
      "description": "공연 삭제 시 예매자가 1명이라도 있으면 삭제를 절대 차단한다. 모든 예매자에게 환불 조치를 완료한 후에만 삭제가 가능하도록 한다.",
      "acceptanceCriteria": [
        "공연 삭제 요청 시 해당 이벤트의 활성 티켓(status=issued/reserved) 수를 조회",
        "활성 티켓이 1건이라도 있으면 삭제 차단 — '예매자 N명이 있어 삭제할 수 없습니다' 에러 표시",
        "삭제 차단 시 '전체 환불 후 삭제' 안내 메시지 + 환불 처리 화면으로 이동 버튼 제공",
        "전체 환불 기능: 해당 공연의 모든 활성 티켓을 일괄 취소/환불 처리하는 Cloud Function",
        "일괄 환불 시 각 티켓별로 환불 금액 계산 (수수료 정책에 따라) 및 에스크로 차감",
        "일괄 환불 진행 중 프로그레스 표시 (N/M건 처리 중...)",
        "일괄 환불 완료 후 → 공연 삭제 가능 상태로 전환",
        "삭제 전 최종 확인 다이얼로그: '환불 완료된 공연입니다. 정말 삭제하시겠습니까?'",
        "삭제 시 Event.status를 deleted로 변경 (실제 Firestore 문서 삭제가 아닌 소프트 삭제)",
        "삭제된 공연은 목록에서 숨김, 슈퍼어드민만 감사용으로 조회 가능",
        "이미 체크인(used) 된 티켓이 있는 공연은 삭제 불가 (공연 완료 상태이므로)",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 27,
      "passes": true,
      "notes": "안전 제일. 삭제는 소프트 삭제(status=deleted)로 처리하여 데이터 복구 가능. Cloud Function에서 삭제 전 더블체크: tickets 컬렉션에서 eventId 일치 + status in [issued, reserved] 쿼리. 일괄 환불은 batch write로 처리하되, 에스크로 차감은 건별 트랜잭션. 환불 실패 건이 있으면 삭제 차단 유지. EventStatus enum에 deleted 추가."
    },
    {
      "id": "MT-028",
      "title": "Hall — 공연 커뮤니티 채널 (리뷰 공유 + 팬 소통)",
      "description": "공연별 커뮤니티 공간 'Hall'을 만든다. 같은 공연(다른 지역/날짜)끼리 그룹으로 묶어 리뷰를 통합 공유하고, 공연 전후로 팬들이 후기·의견·사진을 올리며 소통할 수 있는 채널이다. 네이버 스마트스토어의 그룹 리뷰 공유와 유사한 개념.",
      "acceptanceCriteria": [
        "── Hall 데이터 모델 ──",
        "Hall 모델: id, name(공연명), description, coverImageUrl, createdBy(셀러ID), tags, followerCount, createdAt",
        "HallPost 모델: id, hallId, userId, type(review/discussion/photo/notice), content, rating(리뷰일 때 1~5), imageUrls[], likeCount, commentCount, createdAt",
        "HallComment 모델: id, postId, userId, content, createdAt",
        "halls 컬렉션, hallPosts 서브컬렉션, hallComments 서브컬렉션",
        "",
        "── 공연-Hall 연결 (그룹 리뷰 공유) ──",
        "Event 모델에 hallId 필드 추가 — 같은 공연(다른 지역/날짜)은 동일 hallId 공유",
        "공연 등록 시 셀러가 기존 Hall 선택 또는 새 Hall 생성",
        "같은 hallId를 가진 모든 이벤트의 리뷰가 통합 표시 (지역/날짜 무관)",
        "리뷰 작성 시 어느 이벤트에서 작성했는지 표시 (예: '서울 4/30 공연 관람')",
        "다른 셀러의 Hall에도 연결 가능 (셀러 간 같은 공연 그룹화) — 슈퍼어드민 승인 필요",
        "",
        "── 리뷰 시스템 ──",
        "관람 완료(티켓 status=used) 사용자만 리뷰 작성 가능",
        "리뷰: 별점(1~5) + 텍스트 + 사진(최대 5장)",
        "리뷰 평균 별점 Hall 상단에 표시",
        "리뷰 정렬: 최신순 / 별점 높은순 / 별점 낮은순 / 좋아요순",
        "중복 리뷰 방지: 같은 사용자가 같은 eventId에 리뷰 1건만 가능",
        "리뷰 작성 시 마일리지 적립 (MT-014와 연계)",
        "",
        "── 커뮤니티 기능 ──",
        "Hall 팔로우: 사용자가 Hall을 팔로우하면 새 글 알림",
        "글 유형: 리뷰(review), 자유 토론(discussion), 사진(photo), 공지(notice — 셀러만)",
        "좋아요(하트) + 댓글 기능",
        "셀러가 공지글 작성 가능 (다음 공연 안내, 이벤트 등)",
        "Hall 검색: 공연명, 아티스트명으로 검색",
        "",
        "── UI ──",
        "티켓앱: 공연 상세 하단에 'Hall 입장' 버튼 → Hall 화면으로 이동",
        "티켓앱: Hall 탭 또는 메뉴 (팔로우 중인 Hall 목록)",
        "Hall 화면: 커버 이미지 + 공연명 + 평균 별점 + 팔로워 수 + 탭(리뷰/토론/사진/공지)",
        "어드민: 셀러가 자기 Hall 관리 (공지 작성, 부적절 글 삭제/숨김)",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 28,
      "passes": true,
      "notes": "Hall = 공연 커뮤니티 채널. 핵심은 같은 공연 그룹화로 리뷰 통합. halls/{hallId}/posts/{postId}/comments/{commentId} 구조. Event.hallId로 연결. Hall 팔로우는 users/{uid}/followedHalls 서브컬렉션 또는 hallFollowers/{hallId}/users. 리뷰 평균 별점은 Hall 문서에 averageRating, reviewCount 캐시 필드 유지 (Cloud Function onWrite 트리거로 갱신). 부적절 콘텐츠 신고 기능은 추후. 사진 업로드는 Firebase Storage halls/{hallId}/posts/{postId}/ 경로."
    },
    {
      "id": "MT-029",
      "title": "어드민 사이드바 항상 열림 — 고정형 네비게이션",
      "description": "어드민 왼쪽 사이드바를 드로어(접이식)가 아닌 항상 열려있는 고정형으로 변경한다. 어떤 메뉴(대시보드, 공연관리, 통계, 공연장관리 등)를 들어가더라도 사이드바가 항상 화면 왼쪽에 표시되어야 한다.",
      "acceptanceCriteria": [
        "사이드바가 모든 어드민 화면에서 항상 왼쪽에 고정 표시",
        "어떤 메뉴를 클릭해서 이동해도 사이드바가 닫히지 않음",
        "현재 활성 메뉴 항목이 하이라이트 표시",
        "사이드바 너비 고정 (콘텐츠 영역과 Row 레이아웃)",
        "기존 드로어(오버레이) 방식 제거, 햄버거 메뉴 불필요",
        "flutter analyze 통과"
      ],
      "priority": 29,
      "passes": true,
      "notes": "MT-023에서 드로어 방식으로 변경했던 것을 다시 고정형으로 되돌림. Row(sidebar, Expanded(content)) 레이아웃. 모든 라우트에서 사이드바가 유지되도록 ShellRoute 또는 공통 레이아웃 위젯 사용."
    },
    {
      "id": "MT-030",
      "title": "스마트 티켓 — 비행기 티켓 디자인 + 내 좌석뷰 연동",
      "description": "티켓 상세 화면을 비행기 탑승권 스타일의 스마트 티켓으로 리디자인하고, 해당 좌석의 시야 사진(360° 좌석뷰)을 티켓 내에서 바로 확인할 수 있게 한다.",
      "acceptanceCriteria": [
        "티켓 상세 화면을 비행기 탑승권(boarding pass) 스타일로 리디자인",
        "상단: 공연명, 날짜/시간, 공연장명",
        "중단: 좌석 정보 (등급, 구역, 열, 번호) — 대형 폰트로 강조",
        "하단: QR 코드, 입장번호/바코드",
        "좌우 점선 절취선 디자인 (탑승권 느낌)",
        "티켓 카드에 '내 좌석뷰 보기' 버튼 추가",
        "버튼 클릭 시 해당 좌석의 시야 사진을 바텀시트 또는 풀스크린으로 표시",
        "시야 사진은 venueViews 컬렉션에서 5단계 매칭으로 조회 (exact seat → exact row → nearest row → seat no row → zone representative)",
        "360° 시야가 있으면 파노라마 뷰어로 표시",
        "시야 사진이 없으면 '시야 정보 없음' 안내",
        "flutter analyze 통과"
      ],
      "priority": 30,
      "passes": true,
      "notes": "ticket_detail_screen.dart 전체 리디자인. 비행기 탑승권 레퍼런스: 둥근 모서리 카드, 상단/하단 분리, 점선 구분선, 바코드/QR 영역. 좌석뷰는 기존 venue_view_repository.dart의 5단계 매칭 로직 재활용. AppTheme 다크+골드 테마 유지."
    },
    {
      "id": "MT-031",
      "title": "공연장 관리 권한 분리 — AdminMaster 승인제",
      "description": "공연장 최종 관리 권한을 AdminMaster(슈퍼어드민)로 제한한다. 일반 어드민(셀러)은 공연장을 직접 등록/수정할 수 없고, 공연장 사용 요청을 보내면 AdminMaster가 승인한 뒤에만 사용 가능하다.",
      "acceptanceCriteria": [
        "공연장 등록/수정/삭제는 superAdmin만 가능",
        "일반 seller는 공연장 목록을 조회할 수 있지만 직접 생성/수정 불가",
        "seller가 새 공연장이 필요하면 '공연장 요청' 기능으로 정보 제출 (이름, 주소, 좌석 수 등)",
        "venueRequests 컬렉션에 요청 문서 저장 (sellerId, venueName, address, seatCount, status, requestedAt)",
        "superAdmin 대시보드에 '공연장 요청' 관리 탭 추가 — 승인/거절 처리",
        "승인 시 venues 컬렉션에 공연장 문서 자동 생성 + 요청자에게 승인 알림",
        "seller는 승인된 공연장만 공연 등록 시 선택 가능",
        "기존 공연장 관리 화면에서 역할별 권한 분기 (superAdmin: 전체 관리, seller: 조회+요청만)",
        "flutter analyze 통과"
      ],
      "priority": 31,
      "passes": true,
      "notes": "Firestore Security Rules에서 venues 컬렉션 write를 superAdmin으로 제한. venueRequests/{requestId} 컬렉션 추가. seller 화면에서는 공연장 목록을 읽기 전용으로 표시하고, '새 공연장 요청' 버튼만 노출. superAdmin 사이드바에 '공연장 요청' 메뉴 또는 공연장 관리 화면 내 탭으로 추가."
    },
    {
      "id": "MT-032",
      "title": "엑셀 좌석배치도 → 도트 좌석 변환 고도화 + 예시 가이드",
      "description": "엑셀 좌석배치도 업로드 → 도트 좌석 변환 기능을 세밀하게 개선하고, 사용자가 어떤 형식으로 엑셀을 작성해야 하는지 예시 파일과 가이드를 함께 제공한다.",
      "acceptanceCriteria": [
        "엑셀 업로드 시 자동 파싱 정확도 향상 — 다양한 엑셀 형식 지원",
        "지원 형식 1: 행/열 기반 (행=좌석열, 열=좌석번호, 셀값=등급코드)",
        "지원 형식 2: 목록 기반 (구역, 층, 열, 번호, 등급 컬럼)",
        "지원 형식 3: 시각적 배치 기반 (엑셀에서 좌석을 시각적으로 배치, 빈 셀=통로)",
        "파싱 결과 미리보기에서 오류/경고 표시 (누락 좌석, 중복 좌석, 등급 불일치 등)",
        "예시 엑셀 템플릿 다운로드 버튼 제공 (각 형식별 1개씩, 총 3개)",
        "업로드 화면에 '엑셀 작성 가이드' 섹션 — 각 형식의 스크린샷 + 작성 규칙 설명",
        "가이드 내용: 등급코드(VIP/R/S/A), 통로 표시 방법(빈 셀), 층/구역 구분법",
        "파싱 후 도트맵 미리보기에서 좌석 위치/등급 수동 조정 가능",
        "변환 결과를 Firestore에 저장하기 전 최종 확인 단계",
        "flutter analyze 통과"
      ],
      "priority": 32,
      "passes": true,
      "notes": "기존 MT-018의 엑셀 파싱 기능을 고도화. 예시 엑셀 파일은 Firebase Storage에 저장하여 다운로드 URL 제공. 가이드는 어드민 화면 내 인라인으로 표시 (별도 페이지 불필요). 시각적 배치 형식이 가장 직관적이므로 메인으로 권장. 엑셀 파싱 라이브러리: dart excel 패키지 사용."
    },
    {
      "id": "MT-033",
      "title": "소셜 로그인 상단 배치 + 최근 로그인 표시",
      "description": "로그인 화면에서 소셜 계정 로그인(카카오, 네이버 등) 버튼을 화면 상단에 배치하고, 가장 최근에 로그인한 소셜 계정에 작은 표시(뱃지)를 추가하여 사용자가 어떤 계정으로 마지막에 로그인했는지 쉽게 확인할 수 있게 한다.",
      "acceptanceCriteria": [
        "로그인 화면 레이아웃 변경: 소셜 로그인 버튼들이 화면 상단(또는 최상위)에 위치",
        "이메일/비밀번호 로그인은 소셜 로그인 아래에 배치",
        "소셜 로그인 버튼 순서: 카카오 → 네이버 → Google → Apple (사용 빈도 순)",
        "최근 로그인한 소셜 계정 버튼에 '최근 사용' 뱃지/아이콘 표시",
        "최근 로그인 정보는 SharedPreferences/localStorage에 저장 (lastLoginProvider: 'kakao'|'naver'|'google' 등)",
        "뱃지 디자인: 작은 체크마크 또는 '최근' 텍스트 라벨",
        "소셜 로그인 섹션과 이메일 로그인 섹션 사이에 구분선 (또는 'OR' 텍스트)",
        "flutter analyze 통과"
      ],
      "priority": 33,
      "passes": true,
      "notes": "로그인 성공 시 SharedPreferences에 lastLoginProvider 저장. 로그인 화면 진입 시 읽어와서 해당 소셜 버튼에 뱃지 표시. 게스트 체험 버튼은 하단에 배치. AppTheme 다크+골드 테마 유지."
    },
    {
      "id": "MT-034",
      "title": "공연 좌석관리 — 좌석배치도 + 예매자 정보 조회",
      "description": "어드민에서 공연 관리 > 공연 클릭 > 좌석 관리에 들어가면 해당 공연의 좌석배치도(도트맵)를 보여주고, 각 좌석을 클릭하면 해당 좌석의 예매자 이름, 전화번호 등 예매 정보를 확인할 수 있게 한다.",
      "acceptanceCriteria": [
        "공연 상세 > 좌석 관리 화면에 도트맵 좌석배치도 표시",
        "좌석별 상태 색상 구분: 예매됨(골드), 사용가능(그린), 체크인됨(블루), 취소됨(회색)",
        "예매된 좌석 클릭 시 예매자 정보 팝업/패널 표시",
        "표시 정보: 예매자 이름(displayName), 전화번호(phoneNumber), 이메일",
        "주문 정보: 주문번호, 주문일시, 결제금액, 주문상태",
        "티켓 정보: 티켓ID, 티켓상태(issued/used/canceled), 체크인 여부",
        "좌석 검색 기능: 좌석번호 또는 예매자 이름으로 검색 → 해당 좌석 하이라이트",
        "전체 예매 현황 요약: 총 좌석 / 예매된 좌석 / 잔여 좌석 / 체크인 수",
        "예매자 목록 테이블 뷰 전환 가능 (도트맵 뷰 ↔ 테이블 뷰)",
        "flutter analyze 통과"
      ],
      "priority": 34,
      "passes": true,
      "notes": "어드민 공연 상세 화면에서 좌석 관리 탭 또는 별도 라우트. 좌석 데이터는 seats 컬렉션에서 eventId로 조회. 예매자 정보는 seat.orderId → orders/{orderId} → userId → users/{userId} 조인. 대량 좌석(1000석+) 성능 고려하여 캐시 또는 일괄 로드. CustomPainter 기반 도트맵 렌더링."
    },
    {
      "id": "MT-035",
      "title": "테스트 계정 전환 시스템 — 관객/admin/adminMaster 역할 스위칭",
      "description": "마스터 계정(현재 계정)에서 관객(user), admin(seller), adminMaster(superAdmin) 역할의 테스트 계정을 생성하고, 화면에서 역할을 전환해가며 테스트할 수 있는 기능을 구현한다.",
      "acceptanceCriteria": [
        "마스터(superAdmin) 계정 전용 '테스트 모드' 기능",
        "테스트 계정 자동 생성: user(관객), seller(일반 어드민), superAdmin(마스터) 3개 역할",
        "화면 상단 또는 하단에 역할 전환 바(bar) 표시 — 현재 역할 표시 + 전환 버튼",
        "역할 전환 시 해당 역할의 권한으로 앱 동작 (UI/기능 제한 반영)",
        "관객 모드: 공연 검색, 예매, 티켓 확인만 가능",
        "admin 모드: 자기 공연 관리, 대시보드 접근 (공연장 요청만 가능)",
        "adminMaster 모드: 전체 관리 (공연장 관리, 셀러 관리, 정산 등)",
        "역할 전환은 실제 Firestore 사용자 role을 임시 변경하는 방식 (또는 로컬 오버라이드)",
        "테스트 모드임을 알리는 배너/뱃지 항상 표시",
        "flutter analyze 통과"
      ],
      "priority": 35,
      "passes": true,
      "notes": "superAdmin만 사용 가능한 개발/테스트 도구. 역할 전환은 Firestore의 users 문서 role 필드를 직접 변경하는 방식보다, 클라이언트에서 roleOverride 상태를 Riverpod으로 관리하는 것이 안전. roleOverride가 있으면 실제 role 대신 오버라이드 값 사용. 테스트 모드 배너: '테스트 모드 — 현재: 관객' 같은 형태."
    },
    {
      "id": "MT-036",
      "title": "공연 등록 — 커뮤니티 연결 UI 개선 (가로 체크박스, hallId 제거)",
      "description": "공연 등록 화면의 커뮤니티 연결 섹션을 개선한다. 'Hall 커뮤니티 연결'이 세로로 표시되는 버그를 수정하여 가로로 표시하고, 체크박스로 연결 여부를 선택하게 하며, hallId 직접 입력 방식은 제거한다.",
      "acceptanceCriteria": [
        "'Hall 커뮤니티 연결' 텍스트가 가로(한 줄)로 정상 표시",
        "체크박스로 커뮤니티 연결 여부 ON/OFF 선택",
        "체크 시 기존 Hall 목록에서 선택하거나 새 Hall 자동 생성",
        "hallId 직접 입력 필드 제거",
        "UI가 깔끔하게 한 줄로 정리 (체크박스 + 라벨 + 선택된 Hall명)",
        "flutter analyze 통과"
      ],
      "priority": 36,
      "passes": true,
      "notes": "event_create_screen.dart의 _buildHallSelector() 수정. 현재 세로로 글자가 나오는 레이아웃 버그 수정. CheckboxListTile 또는 Row(Checkbox, Text) 구조로 변경. hallId 입력 대신 Hall 이름 드롭다운 또는 자동 생성. 두번째 스크린샷 참고."
    },
    {
      "id": "MT-037",
      "title": "공연 등록 — 비지정석(스탠딩) 위치를 공연장 카테고리 아래로 이동",
      "description": "공연 등록 화면에서 '비지정석(스탠딩)' 토글의 위치를 현재 위치에서 공연장 카테고리(태그) 바로 아래로 이동한다.",
      "acceptanceCriteria": [
        "비지정석(스탠딩) 토글을 공연장 카테고리(내한/단독/앙콜/...) 영역 바로 아래에 배치",
        "기존 위치에서 제거",
        "토글 ON 시 기존과 동일하게 좌석 배치/등급 설정 비활성화",
        "UI 흐름: 카테고리 선택 → 비지정석 여부 → 공연장 선택 순서",
        "flutter analyze 통과"
      ],
      "priority": 37,
      "passes": true,
      "notes": "event_create_screen.dart에서 _isStanding 토글 위젯의 위치만 이동. 기능 변경 없이 순서만 변경. 두번째 스크린샷에서 현재 위치 확인 가능 — 카테고리 태그 바로 아래로."
    },
    {
      "id": "MT-038",
      "title": "스마트 티켓 UX 개선 — 좌석뷰 인라인 표시 + 영수증 접기 + 프리미엄 디자인",
      "description": "스마트 티켓(승차권 정보) 화면의 UX를 대폭 개선한다. (1) 내 좌석에서 본 시야 사진을 티켓 카드 내에 바로 표시하여 바텀시트를 열지 않아도 확인 가능하게 하고, (2) 영수증 섹션을 접이식(ExpansionTile)으로 변경하여 화면을 간결하게 유지하며, (3) 스마트 티켓 전체 디자인을 프리미엄 감성으로 리디자인한다.",
      "acceptanceCriteria": [
        "── 좌석뷰 인라인 표시 ──",
        "보딩패스 카드 내 좌석 정보 영역 아래에 좌석 시야 사진을 인라인으로 표시",
        "기존 5단계 매칭 로직 유지 (exact seat → exact row → nearest row → seat no row → zone representative)",
        "사진은 적절한 높이(200~240px)로 표시, 탭하면 풀스크린/바텀시트로 확대",
        "360° 시야인 경우 파노라마 아이콘 + '360° 시야' 뱃지 표시",
        "시야 사진이 없으면 해당 영역 자체를 숨김 (빈 공간 없이)",
        "CachedNetworkImage 사용, 로딩 중 시머/스켈레톤 표시",
        "",
        "── 영수증 접이식 (Collapsible) ──",
        "영수증 카드를 ExpansionTile 또는 AnimatedCrossFade로 접기/펼치기 가능하게 변경",
        "기본 상태: 접힌 상태 (결제금액만 요약 표시)",
        "접힌 상태에서 보이는 정보: '영수증' 타이틀 + 결제금액 + 펼치기 아이콘(chevron)",
        "펼치면 기존 영수증 상세 정보 전체 표시 (결제방식, 승차권 상태, 공연 시작, 발행일시 등)",
        "부드러운 접기/펼치기 애니메이션 (300ms)",
        "",
        "── 프리미엄 디자인 리뉴얼 ──",
        "보딩패스 카드의 그라디언트/색상/타이포 세련되게 개선",
        "좌석 정보 영역: 등급 뱃지 색상 강화, 구역/층/열/번호 레이아웃 개선",
        "QR 코드 영역: 보다 깔끔한 배치, 예매번호/발행일시 타이포 개선",
        "카드 전체에 미묘한 그림자/보더 효과로 입체감 추가",
        "다크 테마(#0B0B0F) + 골드(#C9A84C) 기조 유지하면서 현대적 감성 반영",
        "flutter analyze 통과"
      ],
      "priority": 38,
      "passes": false,
      "notes": "ticket_detail_screen.dart의 _BoardingPassTicket 위젯 중심으로 수정. 좌석뷰는 기존 _SeatViewButton + 바텀시트 로직을 인라인 표시로 전환하되, 탭하면 확대 보기는 유지. 영수증은 _TicketReceiptCard를 ExpansionTile로 래핑. 디자인 개선은 AppTheme 색상/폰트 활용, GoogleFonts.inter + AppTheme.nanum 조합. 기존 _BoardingPassClipper(절취선) 유지하면서 내부 레이아웃만 개선. venueViewsProvider로 시야 데이터 로드, VenueViewRepository.buildKey()로 5단계 매칭."
    },
    {
      "id": "MT-039",
      "title": "좌석 등록 화면 UI 개선 — 등록 확인 + 좌석 요약 정보 표시",
      "description": "어드민의 좌석 등록(CSV 업로드) 화면을 개선한다. 현재 CSV 텍스트만 보이는 밋밋한 화면에 등록 완료 확인 상태, 현재 등록된 좌석 요약 정보(총 좌석 수, 등급별 수, 구역별 수)를 함께 표시하여 한눈에 파악 가능하게 한다.",
      "acceptanceCriteria": [
        "좌석 등록 화면 상단에 현재 등록 상태 표시 (등록된 좌석 수, 마지막 업로드 시각)",
        "등록 완료 시 성공 뱃지/아이콘 + '좌석 등록 완료' 메시지 명확히 표시",
        "등록된 좌석 요약 카드: 총 좌석 수, 등급별(VIP/R/S/A) 좌석 수, 구역별 좌석 수",
        "요약 카드에 등급별 색상 구분 (VIP=골드, R=레드, S=블루, A=그린)",
        "CSV 형식 안내를 더 직관적으로 개선 (예시 테이블 형태로 시각화)",
        "업로드 후 결과 미리보기에서 파싱된 좌석 수 + 오류 건수 표시",
        "전체 UI를 AdminTheme 기반으로 깔끔하게 리디자인",
        "flutter analyze 통과"
      ],
      "priority": 39,
      "passes": false,
      "notes": "melon_admin의 좌석 등록 화면. 현재 CSV 텍스트 입력 + PREVIEW 버튼 + UPLOAD SEATS 버튼 구성. Firestore seats 컬렉션에서 해당 venueId의 좌석을 집계하여 요약 카드 표시. AdminTheme + shadcn_flutter 활용."
    },
    {
      "id": "MT-040",
      "title": "어드민 사이드바 모든 하위 화면에서 유지 — 라우팅 구조 수정",
      "description": "어드민 사이드바가 공연장 관리, 좌석 등록 등 하위 화면으로 이동하면 사라지는 버그를 수정한다. 모든 어드민 화면에서 사이드바가 항상 왼쪽에 고정 표시되도록 라우팅 구조를 ShellRoute 기반으로 통일한다.",
      "acceptanceCriteria": [
        "공연장 관리 화면 진입 시 사이드바 유지",
        "좌석 등록 화면 진입 시 사이드바 유지",
        "공연 상세/수정 화면 진입 시 사이드바 유지",
        "예매자 목록 화면 진입 시 사이드바 유지",
        "기타 모든 하위 화면(통계, 마일리지, 정산 등)에서 사이드바 유지",
        "ShellRoute로 사이드바를 감싸는 공통 레이아웃 적용",
        "현재 활성 메뉴 하이라이트가 하위 화면에서도 올바르게 표시",
        "뒤로가기(←) 버튼과 사이드바 네비게이션 충돌 없이 동작",
        "flutter analyze 통과"
      ],
      "priority": 40,
      "passes": false,
      "notes": "MT-029에서 사이드바 고정형으로 변경했으나, 일부 하위 라우트(공연장 관리, 좌석 등록 등)가 ShellRoute 밖에서 독립 라우트로 정의되어 사이드바가 사라지는 문제. GoRouter의 ShellRoute 내부에 모든 어드민 라우트를 포함시키거나, admin_layout_shell 위젯으로 통일. routes 정의 점검 필요."
    },
    {
      "id": "MT-041",
      "title": "예매자 목록 로딩 버그 수정 — 데이터 로드 실패 디버깅",
      "description": "어드민에서 예매자 목록(주문 목록) 화면에 진입하면 로딩 스피너만 계속 돌고 데이터가 표시되지 않는 버그를 수정한다.",
      "acceptanceCriteria": [
        "예매자 목록 화면 진입 시 주문/티켓 데이터가 정상 로드되어 표시",
        "Firestore 쿼리가 올바른 컬렉션/필터로 실행되는지 확인",
        "Provider/StreamProvider 구독이 정상 동작하는지 확인",
        "데이터가 없을 경우 '예매 내역이 없습니다' 빈 상태 메시지 표시",
        "에러 발생 시 에러 메시지 표시 (무한 로딩 방지)",
        "로딩 타임아웃 처리 (10초 이상 시 재시도 버튼 표시)",
        "flutter analyze 통과"
      ],
      "priority": 41,
      "passes": false,
      "notes": "admin_orders_screen.dart 또는 관련 주문 목록 화면 점검. StreamProvider/FutureProvider의 when() 패턴에서 error 케이스 처리 확인. Firestore Security Rules에서 seller 권한으로 orders 읽기가 허용되는지 확인. eventId 필터 누락 또는 인덱스 미생성 가능성."
    },
    {
      "id": "MT-042",
      "title": "좌석 등록 인터랙티브 도트맵 편집 — CSV 대신 클릭 기반 좌석 배치",
      "description": "좌석 등록을 CSV 텍스트 입력 방식에서 벗어나, 인터랙티브 도트맵 캔버스에서 직접 좌석을 클릭하여 배치하고, 등급/구역/열을 지정할 수 있는 시각적 편집 모드를 기본으로 제공한다. CSV 업로드는 보조 수단으로 유지.",
      "acceptanceCriteria": [
        "좌석 등록 화면에 인터랙티브 도트맵 캔버스 추가 (기본 모드)",
        "빈 그리드(도트) 캔버스에서 등급 선택 후 빈 도트 클릭 = 좌석 생성 (페인트 방식)",
        "상단 툴바: 등급 선택(VIP/R/S/A), 구역 입력, 행/열 자동 번호 매김",
        "생성된 좌석 클릭 시 속성 편집 팝업 (등급, 구역, 열, 번호 수정)",
        "좌석 드래그 이동, 다중 선택 후 일괄 등급 변경 지원",
        "Delete 키 또는 우클릭으로 좌석 삭제",
        "무대 위치 표시 (상단/하단 토글)",
        "도트맵 핀치 줌/패닝 지원",
        "CSV 업로드는 '파일에서 가져오기' 보조 버튼으로 유지",
        "편집 완료 후 '저장' 버튼으로 Firestore seats 컬렉션에 일괄 저장",
        "저장 전 미리보기 + 유효성 검증 (중복 좌석, 빈 번호 등)",
        "flutter analyze 통과"
      ],
      "priority": 42,
      "passes": false,
      "notes": "MT-018의 도트맵 시스템을 좌석 등록에 확장 적용. CustomPainter + GestureDetector 기반. 등급 색상: VIP=#C9A84C, R=#E53935, S=#1E88E5, A=#43A047. 그리드 사이즈는 공연장 규모에 따라 조정 가능하게. 좌석 데이터는 seats 컬렉션에 venueId + eventId로 저장. 대규모(1000석+) 성능 고려."
    },
    {
      "id": "MT-043",
      "title": "좌석 통합 관리 — 도트맵에서 좌석 클릭 시 예매자 + 배정 정보 통합 조회",
      "description": "어드민에서 좌석배치도(도트맵)의 좌석을 클릭하면 해당 좌석의 예매자 정보와 배정 상태를 하나의 통합 패널에서 확인할 수 있게 한다. 기존 별도 메뉴로 분리된 '좌석 현황'과 '예매자 목록'을 하나로 합친다.",
      "acceptanceCriteria": [
        "도트맵에서 좌석 클릭 시 사이드 패널 또는 팝업으로 통합 정보 표시",
        "── 좌석 정보 ──",
        "좌석 등급, 구역, 층, 열, 번호",
        "좌석 상태: available / reserved / sold / checked-in / canceled (색상 구분)",
        "── 예매자 정보 (예매된 좌석인 경우) ──",
        "예매자 이름(displayName), 전화번호, 이메일",
        "주문번호, 주문일시, 결제금액, 주문상태",
        "티켓 상태(issued/used/canceled), 체크인 여부 + 시각",
        "── 액션 버튼 ──",
        "좌석 상태 수동 변경 (관리자용: available ↔ reserved 전환 등)",
        "해당 예매 건 상세 페이지로 이동 링크",
        "전체 뷰에서 도트맵 ↔ 테이블 리스트 뷰 전환 가능",
        "좌석 검색: 좌석번호 또는 예매자 이름으로 검색 → 해당 좌석 하이라이트",
        "상단 요약: 총 좌석 / 예매됨 / 잔여 / 체크인 수",
        "flutter analyze 통과"
      ],
      "priority": 43,
      "passes": false,
      "notes": "MT-034(좌석배치도+예매자)를 통합 발전. 공연 상세 > 좌석 관리에서 도트맵과 예매자 정보를 한 화면에. 좌석 데이터: seats 컬렉션. 예매자 조인: seat.orderId → orders → userId → users. 대량 좌석 성능: 좌석 전체 일괄 로드 + 메모리 캐시. 사이드 패널은 좌석 클릭 시 슬라이드 인."
    },
    {
      "id": "MT-044",
      "title": "공연별 일별 티켓 판매 통계 대시보드",
      "description": "어드민에서 공연별로 하루에 몇 장의 티켓이 판매되었는지 일별 판매 추이를 차트와 테이블로 확인할 수 있는 통계 대시보드를 추가한다.",
      "acceptanceCriteria": [
        "어드민 사이드바에 '판매 통계' 메뉴 추가 (또는 기존 통계 메뉴 내 탭)",
        "공연 선택 드롭다운 → 선택한 공연의 일별 판매 데이터 표시",
        "── 일별 판매 차트 ──",
        "X축: 날짜, Y축: 판매 수량 (라인 차트 또는 바 차트)",
        "판매 시작일 ~ 현재까지 기간 표시",
        "등급별(VIP/R/S/A) 색상 구분 가능한 스택 차트",
        "── 일별 판매 테이블 ──",
        "날짜 | 판매 수 | 취소 수 | 순판매 | 누적 판매 | 매출액",
        "등급별 필터링 가능",
        "── 요약 카드 ──",
        "총 판매 수, 총 매출액, 평균 일 판매량, 판매율(판매/전체 좌석 %)",
        "최고 판매일 하이라이트",
        "기간 필터: 최근 7일 / 30일 / 전체 / 커스텀 기간",
        "데이터 CSV 내보내기 버튼",
        "flutter analyze 통과"
      ],
      "priority": 44,
      "passes": false,
      "notes": "orders/tickets 컬렉션에서 eventId + createdAt 기준으로 집계. 차트 라이브러리: fl_chart 또는 syncfusion_flutter_charts. 대량 데이터 성능: Cloud Function으로 일별 집계 캐시 생성하거나, 클라이언트에서 날짜별 그루핑. AdminTheme 기반 UI. 등급 색상: VIP=#C9A84C, R=#E53935, S=#1E88E5, A=#43A047."
    },
    {
      "id": "MT-045",
      "title": "인터미션 실시간 티켓 검증 — 라이브 인디케이터 + 모의 체험 단계 추가",
      "description": "공연 중간 인터미션 때 QR 코드를 다시 찍지 않고도, 티켓 화면에 실시간(라이브) 상태임을 증명하는 시각적 인디케이터를 추가한다. 스크린샷이 아닌 실제 앱 화면임을 직관적으로 확인할 수 있도록 계속 움직이는 애니메이션 요소를 활용한다. 기존 QR 유효시간 카운트다운을 발전시킨 형태. 또한 데모 테스트 플로우에 인터미션 체크 단계를 추가한다.",
      "acceptanceCriteria": [
        "── 라이브 인디케이터 (티켓앱) ──",
        "티켓 상세 화면에 '실시간 인증' 라이브 인디케이터 영역 추가",
        "인디케이터 요소: 계속 움직이는 애니메이션 (파동/물결/그라디언트 시프트/파티클 등)",
        "현재 시각 실시간 표시 (초 단위까지, 매초 갱신)",
        "기존 QR 유효시간 카운트다운과 연계 — 카운트다운 자체를 더 눈에 띄게 디자인",
        "라이브 상태 뱃지: 'LIVE' 텍스트 + 깜빡이는 빨간 점 (방송 라이브 느낌)",
        "인터미션 모드일 때 특별 UI: '인터미션 — 티켓 확인 중' 상태 표시",
        "스크린샷과 구별되는 핵심: 시간이 흐르고 있음 + 애니메이션이 동작 중임을 육안으로 확인 가능",
        "",
        "── 인터미션 체크 (어드민/스태프) ──",
        "스태프가 관객의 티켓 화면을 육안으로 확인하는 방식 (QR 스캔 불필요)",
        "확인 포인트: (1) LIVE 인디케이터가 움직이고 있는가 (2) 시간이 실시간으로 흐르는가 (3) 공연명/좌석이 맞는가",
        "",
        "── 데모 테스트 플로우 추가 ──",
        "demo_test_screen.dart에 '인터미션 체크' 단계 추가 (QR 입장 후)",
        "인터미션 단계에서 티켓의 라이브 인디케이터가 정상 동작하는지 시뮬레이션",
        "체크 결과: LIVE 확인됨 / 스크린샷 의심 (시간 정지) 표시",
        "flutter analyze 통과"
      ],
      "priority": 45,
      "passes": false,
      "notes": "핵심은 '스크린샷 방지'. 스크린샷은 시간이 멈추고 애니메이션이 정지하므로 실제 앱과 구별됨. 기존 _QrTimerBadge의 카운트다운을 발전시켜 더 시각적으로 풍부하게. AnimationController + CustomPainter로 물결/파동 효과. 현재 시각은 Timer.periodic(1초)로 갱신. LIVE 뱃지는 opacity 애니메이션(깜빡임). ticket_detail_screen.dart + demo_test_screen.dart 수정."
    },
    {
      "id": "MT-046",
      "title": "티켓 취소/환불 오류 수정 — Cloud Function INTERNAL 에러 디버깅",
      "description": "데모 테스트 또는 티켓 상세에서 '티켓 취소/환불' 버튼을 누르면 [firebase_functions/internal] INTERNAL 에러가 발생하는 버그를 수정한다.",
      "acceptanceCriteria": [
        "requestTicketCancellation Cloud Function 에러 원인 파악 및 수정",
        "티켓 취소 요청 시 정상적으로 환불 처리 완료",
        "취소 후 티켓 상태가 canceled로 변경",
        "취소 후 좌석이 available로 복원",
        "에스크로 잔액 차감이 정상 동작 (에스크로 계정이 없는 경우 graceful 처리)",
        "에러 발생 시 사용자에게 명확한 에러 메시지 표시 (INTERNAL 대신 구체적 사유)",
        "Cloud Functions 로그에서 에러 스택트레이스 확인 후 근본 원인 해결",
        "npm run build 통과, flutter analyze 통과"
      ],
      "priority": 46,
      "passes": false,
      "notes": "스크린샷에서 [02:41:51] 취소 오류: [firebase_functions/internal] INTERNAL 확인됨. requestTicketCancellation 함수 디버깅 필요. 가능한 원인: (1) 에스크로 계정 미존재 시 escrowAccounts/{sellerId} 읽기 실패, (2) 수수료 계산 로직 오류, (3) 트랜잭션 내 참조 오류, (4) Firestore Security Rules 권한 문제. Cloud Functions 로그(firebase functions:log) 확인 우선."
    },
    {
      "id": "MT-047",
      "title": "모의 티켓 생성 — 테스트 계정 권한 오류 수정 + sinbun001@naver.com 관객 계정 생성",
      "description": "모의 티켓 생성 화면에서 테스트 계정으로 티켓을 생성할 때 [cloud_firestore/permission-denied] 오류가 발생하는 문제를 수정한다. 또한 sinbun001@naver.com을 관객(user) 역할의 테스트 계정으로 등록한다.",
      "acceptanceCriteria": [
        "── 권한 오류 수정 ──",
        "모의 티켓 생성 시 permission-denied 오류 해결",
        "Firestore Security Rules에서 모의 티켓 생성에 필요한 컬렉션(tickets, orders, seats, users) 쓰기 권한 확인",
        "superAdmin/seller 역할이 테스트 계정 대신 티켓을 생성할 수 있도록 규칙 수정",
        "모의 티켓이 대상 계정(관객)의 마이티켓에 정상 표시",
        "",
        "── 테스트 관객 계정 ──",
        "sinbun001@naver.com 계정을 Firestore users 컬렉션에 등록",
        "역할: user(관객), displayName: '테스트 관객', role: 'user'",
        "모의 티켓 생성 화면의 대상 계정 드롭다운에 sinbun001@naver.com 표시",
        "해당 계정으로 로그인 시 관객 화면(마이티켓, 공연 검색, 예매) 정상 접근",
        "flutter analyze 통과"
      ],
      "priority": 47,
      "passes": false,
      "notes": "스크린샷에서 [cloud_firestore/permission-denied] Missing or insufficient permissions 확인됨. mock_ticket_screen.dart에서 Firestore 직접 쓰기 시 Security Rules가 차단하는 것으로 추정. 해결 방안: (1) Security Rules에서 superAdmin의 모의 티켓 생성 허용, (2) Cloud Function으로 모의 티켓 생성 이관 (서버 사이드에서 admin SDK로 우회). sinbun001@naver.com은 Firebase Auth에 계정 생성 + Firestore users 문서 생성 필요. 이메일/비밀번호 로그인 또는 네이버 소셜 로그인 연동."
    },
    {
      "id": "MT-048",
      "title": "정산 관리 화면 — 뒤로가기 버튼 추가",
      "description": "어드민 정산 관리 화면에 뒤로가기(←) 버튼을 추가하여 이전 화면으로 돌아갈 수 있게 한다. 현재 정산 관리 화면에 네비게이션 수단이 없어 사이드바가 사라진 상태에서 갇히는 문제를 해결한다.",
      "acceptanceCriteria": [
        "정산 관리 화면 상단 좌측에 뒤로가기(←) 아이콘 버튼 추가",
        "버튼 클릭 시 대시보드 또는 이전 화면으로 이동",
        "AppBar 또는 커스텀 헤더에 자연스럽게 배치",
        "사이드바 고정(MT-040) 전까지 임시로라도 탈출할 수 있도록 보장",
        "flutter analyze 통과"
      ],
      "priority": 48,
      "passes": false,
      "notes": "정산 관리 화면이 ShellRoute 밖에서 독립 라우트로 렌더되어 사이드바가 없는 상태. MT-040(사이드바 전체 유지)이 해결되면 근본적으로 해결되지만, 그 전에도 뒤로가기 버튼은 필요. 기존 다른 하위 화면(공연장 관리 등)과 동일하게 BackButton + 타이틀 패턴 적용."
    },
    {
      "id": "MT-049",
      "title": "전체 공연 라이프사이클 데모 — 등록~판매~입장~인터미션~종료~정산 E2E 시뮬레이션",
      "description": "데모 테스트에서 공연의 전체 라이프사이클을 처음부터 끝까지 시뮬레이션할 수 있는 통합 E2E 데모를 구축한다. 공연 등록 → 좌석 배치 → 티켓 판매(모의 결제) → QR 입장 → 인터미션 체크 → 공연 종료 → 정산 요청 → 정산 승인까지 모든 단계를 하나의 플로우로 순차 실행하며, 각 단계가 올바르게 연결되고 데이터가 전달되는지 검증한다.",
      "acceptanceCriteria": [
        "── 데모 플로우 화면 ──",
        "어드민에 '전체 라이프사이클 데모' 메뉴 또는 기존 데모 테스트 확장",
        "스텝 프로그레스 바: ①공연등록 → ②좌석배치 → ③티켓판매 → ④QR입장 → ⑤인터미션 → ⑥공연종료 → ⑦정산요청 → ⑧정산승인",
        "각 단계별 '실행' 버튼 + 결과 로그 표시 (성공/실패/데이터 요약)",
        "",
        "── ①공연 등록 ──",
        "데모용 공연 자동 생성 (제목, 날짜, 공연장, 가격 프리셋)",
        "생성된 eventId 표시 + 다음 단계로 전달",
        "",
        "── ②좌석 배치 ──",
        "데모 공연에 좌석 자동 생성 (VIP 2석, R 4석, S 6석, A 8석 등 소규모)",
        "생성된 좌석 수 + 등급별 수 확인",
        "",
        "── ③티켓 판매 (모의 결제) ──",
        "테스트 계정(관객)으로 모의 주문 생성 + 모의 결제 완료 처리",
        "모의 결제 = 실제 PG 없이 confirmPaymentAndAssignSeats 직접 호출",
        "발권된 티켓 수 + 좌석 배정 확인",
        "에스크로 입금 시뮬레이션: escrowAccount.balance에 결제금액 적립 확인",
        "",
        "── ④QR 입장 ──",
        "기존 데모 테스트의 QR 입장 검증 플로우 재활용",
        "체크인 성공 확인 (티켓 status: issued → used 전환)",
        "",
        "── ⑤인터미션 체크 ──",
        "라이브 인디케이터 동작 확인 시뮬레이션 (MT-045 연계)",
        "",
        "── ⑥공연 종료 ──",
        "Event.status를 ended로 변경 (또는 endAt 시간 경과 시뮬레이션)",
        "공연 종료 상태 확인",
        "",
        "── ⑦정산 요청 ──",
        "셀러 계정으로 정산 요청 생성 (Settlement 문서 생성)",
        "정산 예정 금액 = 총 매출 - 환불 금액 - 플랫폼 수수료(10%)",
        "정산 요청 상태: pending 확인",
        "",
        "── ⑧정산 승인 ──",
        "슈퍼어드민으로 정산 승인 처리",
        "에스크로 계정에서 수수료 차감 + 정산금 차감 확인",
        "Settlement.status: pending → approved → transferred",
        "최종 에스크로 잔액 = 0 (전액 정산 완료) 확인",
        "",
        "── 검증 로그 ──",
        "각 단계별 Firestore 문서 상태 스냅샷 표시 (before → after)",
        "전체 플로우 소요 시간 표시",
        "실패 단계에서 중단 + 에러 메시지 + 재시도 버튼",
        "모든 단계 성공 시 '전체 라이프사이클 검증 완료 ✓' 최종 결과",
        "flutter analyze 통과, npm run build 통과"
      ],
      "priority": 49,
      "passes": false,
      "notes": "핵심 통합 테스트. 기존 demo_test_screen.dart를 확장하거나 별도 lifecycle_demo_screen.dart 생성. 각 단계는 Cloud Function 또는 Firestore 직접 쓰기로 시뮬레이션. 모의 결제는 실제 PG 없이 confirmPaymentAndAssignSeats 호출. 정산은 settlements 컬렉션 + escrowAccounts 잔액 변동 확인. 데모 데이터는 접두사 'DEMO_'로 구분하여 나중에 일괄 삭제 가능하게. 에스크로 시뮬레이션이 핵심 — deposit → refund(선택) → platformFee → settlement 전체 흐름 검증."
    }
  ]
}
